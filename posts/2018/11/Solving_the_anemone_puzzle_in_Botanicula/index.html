<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="GrammerJack"/><link rel="canonical" href="https://jackpal.github.io/posts/2018/11/Solving_the_anemone_puzzle_in_Botanicula"/><meta name="twitter:url" content="https://jackpal.github.io/posts/2018/11/Solving_the_anemone_puzzle_in_Botanicula"/><meta name="og:url" content="https://jackpal.github.io/posts/2018/11/Solving_the_anemone_puzzle_in_Botanicula"/><title>Solving the anemone puzzle in Botanicula | GrammerJack</title><meta name="twitter:title" content="Solving the anemone puzzle in Botanicula | GrammerJack"/><meta name="og:title" content="Solving the anemone puzzle in Botanicula | GrammerJack"/><meta name="description" content="Jack Palevich's Essays"/><meta name="twitter:description" content="Jack Palevich's Essays"/><meta name="og:description" content="Jack Palevich's Essays"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to GrammerJack"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">GrammerJack</a></div></header><div class="wrapper"><article><div class="content"><h1>Solving the anemone puzzle in Botanicula</h1><p><a href="https://en.wikipedia.org/wiki/Botanicula">Botanicula</a> is a whimsical graphical adventure game for the iPad and other computers. One of the puzzles near the end of the game requires a bit of thinking to solve. When I came upon it, after a couple of hours of play, I was too tired to think. So I wrote some code to brute-force the solution. I'm unreasonably pleased that it worked the first time. Here's the code, cleaned up and commented:</p><pre><code><div class="highlight"><span></span><span class="c1">// Solve the anemone Botanicula puzzle.</span>
<span class="c1">// Number the anenome 1 to 7, left-to-right.</span>
<span class="c1">// Encode a list of anemones into a single integer, where bit 0 is anemone 1, etc.</span>
<span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="kc">_</span> <span class="n">d</span><span class="p">:[</span><span class="nb">Int</span><span class="p">])-&gt;</span><span class="nb">Int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">d</span><span class="p">.</span><span class="bp">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="k">in</span> <span class="n">x</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// A list of which anemones are pulled down when a given anemone is tapped.</span>
<span class="kd">let</span> <span class="nv">moves</span> <span class="p">=</span> <span class="p">[</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]),</span> <span class="c1">// Tap anemone 1</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]),</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">2</span><span class="p">]),</span>
	<span class="n">encode</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="c1">// Tap anemone 7</span>
<span class="p">]</span>

<span class="c1">// Calculate the effect of tapping a given anemone |m|.</span>
<span class="kd">func</span> <span class="nf">move</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">tap</span> <span class="n">m</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)-&gt;</span><span class="nb">Int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">state</span> <span class="o">|</span> <span class="c1">// original state</span>
		<span class="n">encode</span><span class="p">([</span><span class="n">m</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="c1">// raise the item that was tapped</span>
		<span class="o">~</span><span class="n">moves</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">// lower the items that need to be lowered</span>
<span class="p">}</span>

<span class="c1">// Brute force solver. Try all moves to depth |depth|.</span>
<span class="kd">func</span> <span class="nf">solve</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="nb">Int</span><span class="p">]?</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">state</span> <span class="p">==</span> <span class="n">goal</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">[]</span> <span class="c1">// We&#39;ve reached our goal, don&#39;t have to make any moves.</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span> <span class="c1">// Ran out of depth, give up.</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">m</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">..</span><span class="mi">7</span> <span class="p">{</span>
		<span class="kd">let</span> <span class="nv">newState</span> <span class="p">=</span> <span class="n">move</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="n">state</span><span class="p">,</span> <span class="n">tap</span><span class="p">:</span><span class="n">m</span><span class="p">)</span>
		<span class="k">if</span> <span class="kd">let</span> <span class="nv">soln</span> <span class="p">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="n">newState</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span><span class="n">goal</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// If we could solve the newState, prepend our move to that solution.</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">soln</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="c1">// Couldn&#39;t find a solution.</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Produce the shortest solution, if one exists.</span>
<span class="kd">func</span> <span class="nf">tryToSolve</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="nb">Int</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span><span class="nb">Int</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="nb">Int</span><span class="p">)-&gt;</span> <span class="p">[</span><span class="nb">Int</span><span class="p">]?</span> <span class="p">{</span>
	<span class="c1">// Do a breadth first search by searching successively deeper.</span>
	<span class="k">for</span> <span class="n">d</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">..</span><span class="n">depth</span> <span class="p">{</span>
		<span class="k">if</span> <span class="kd">let</span> <span class="nv">soln</span> <span class="p">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="n">state</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span><span class="n">goal</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">soln</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">start</span> <span class="p">=</span> <span class="n">encode</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span> <span class="c1">// This will vary depending upon the state of the puzzle.</span>
<span class="kd">let</span> <span class="nv">goal</span> <span class="p">=</span> <span class="n">encode</span><span class="p">([</span><span class="mi">7</span><span class="p">])</span> <span class="c1">// This is the desired state (just anenome 7 raised.)</span>
<span class="kd">let</span> <span class="nv">solution</span> <span class="p">=</span> <span class="n">tryToSolve</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="n">start</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span><span class="n">goal</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>

<span class="bp">print</span><span class="p">(</span><span class="n">solution</span> <span class="p">??</span> <span class="s">&quot;no solution found&quot;</span><span class="p">)</span>
</div></code></pre></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/swift">Swift</a></li><li><a href="/tags/games">Games</a></li><li><a href="/tags/botanicula">Botanicula</a></li></ul></article></div><footer><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>