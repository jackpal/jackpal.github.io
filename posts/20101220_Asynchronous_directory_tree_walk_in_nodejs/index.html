<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="GrammerJack"/><link rel="canonical" href="https://jackpal.github.io/posts/20101220_Asynchronous_directory_tree_walk_in_nodejs"/><meta name="twitter:url" content="https://jackpal.github.io/posts/20101220_Asynchronous_directory_tree_walk_in_nodejs"/><meta name="og:url" content="https://jackpal.github.io/posts/20101220_Asynchronous_directory_tree_walk_in_nodejs"/><title>Asynchronous directory tree walk in node.js | GrammerJack</title><meta name="twitter:title" content="Asynchronous directory tree walk in node.js | GrammerJack"/><meta name="og:title" content="Asynchronous directory tree walk in node.js | GrammerJack"/><meta name="description" content="Jack Palevich's Essays"/><meta name="twitter:description" content="Jack Palevich's Essays"/><meta name="og:description" content="Jack Palevich's Essays"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to GrammerJack"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">GrammerJack</a></div></header><div class="wrapper"><article><div class="content"><h1>Asynchronous directory tree walk in node.js</h1><p>I wrote an asynchronous directory tree walker in <a href="http://nodejs.org/">node.js</a>. Note the use of Continuation Passing Style in the fileCb callback. That allows the callback to perform its own asynchronous operations before continuing the directory walk.<br><br>(This code is provided under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache Licence 2.0</a>.)<br><br><br><br><br><br><br> // asynchronous tree walk<br> // root - root path<br> // fileCb - callback function (file, next) called for each file<br> // -- the callback must call next(falsey) to continue the iteration,<br> // or next(truthy) to abort the iteration.<br> // doneCb - callback function (err) called when iteration is finished<br> // or an error occurs.<br> //<br> // example:<br> //<br> // forAllFiles('~/',<br> // function (file, next) { sys.log(file); next(); },<br> // function (err) { sys.log("done: " + err); });<br><br><br><br> function forAllFiles(root, fileCb, doneCb) {<br> fs.readdir(root, function processDir(err, files) {<br> if (err) {<br> fileCb(err);<br> } else {<br> if (files.length &gt; 0) {<br> var file = root + '/' + files.shift();<br> fs.stat(file, function processStat(err, stat) {<br> if (err) {<br> doneCb(err);<br> } else {<br> if (stat.isFile()) {<br> fileCb(file, function(err) {<br> if (err) {<br> doneCb(err);<br> } else {<br> processDir(false, files);<br> }<br> });<br> } else {<br> forAllFiles(file, fileCb, function(err) {<br> if (err) {<br> doneCb(err);<br> } else {<br> processDir(false, files);<br> }<br> });<br> }<br> }<br> });<br> } else {<br> doneCb(false);<br> }<br> }<br> });<br> }<br><br><br></p></div><span>Tagged with: </span><ul class="tag-list"></ul></article></div><footer><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>