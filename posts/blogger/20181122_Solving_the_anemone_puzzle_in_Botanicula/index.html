<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="GrammerJack"/><link rel="canonical" href="https://jackpal.github.io/posts/blogger/20181122_Solving_the_anemone_puzzle_in_Botanicula"/><meta name="twitter:url" content="https://jackpal.github.io/posts/blogger/20181122_Solving_the_anemone_puzzle_in_Botanicula"/><meta name="og:url" content="https://jackpal.github.io/posts/blogger/20181122_Solving_the_anemone_puzzle_in_Botanicula"/><title>Solving the anemone puzzle in Botanicula | GrammerJack</title><meta name="twitter:title" content="Solving the anemone puzzle in Botanicula | GrammerJack"/><meta name="og:title" content="Solving the anemone puzzle in Botanicula | GrammerJack"/><meta name="description" content="Jack Palevich's Essays"/><meta name="twitter:description" content="Jack Palevich's Essays"/><meta name="og:description" content="Jack Palevich's Essays"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to GrammerJack"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">GrammerJack</a></div></header><div class="wrapper"><article><div class="content"><h1>Solving the anemone puzzle in Botanicula</h1><p><a href="https://en.wikipedia.org/wiki/Botanicula">Botanicula</a> is a whimsical graphical adventure game for the iPad and other computers. One of the puzzles near the end of the game requires a bit of thinking to solve. When I came upon it, after a couple of hours of play, I was too tired to think. So I wrote some code to brute-force the solution. I'm unreasonably pleased that it worked the first time. Here's the code, cleaned up and commented:</p><pre><code><span class="comment">// Solve the anemone Botanicula puzzle.
// Number the anenome 1 to 7, left-to-right.
// Encode a list of anemones into a single integer, where bit 0 is anemone 1, etc.</span>
<span class="keyword">func</span> encode(<span class="keyword">_</span> d:[<span class="type">Int</span>])-&gt;<span class="type">Int</span> {
	<span class="keyword">return</span> d.<span class="call">reduce</span>(<span class="number">0</span>, {x, y <span class="keyword">in</span> x | (<span class="number">1</span> &lt;&lt; (y-<span class="number">1</span>)) })
}

<span class="comment">// A list of which anemones are pulled down when a given anemone is tapped.</span>
<span class="keyword">let</span> moves = [
	<span class="call">encode</span>([<span class="number">5</span>,<span class="number">7</span>]), <span class="comment">// Tap anemone 1</span>
	<span class="call">encode</span>([<span class="number">3</span>,<span class="number">6</span>]),
	<span class="call">encode</span>([<span class="number">2</span>,<span class="number">4</span>]),
	<span class="call">encode</span>([<span class="number">3</span>,<span class="number">5</span>]),
	<span class="call">encode</span>([<span class="number">4</span>,<span class="number">1</span>]),
	<span class="call">encode</span>([<span class="number">2</span>]),
	<span class="call">encode</span>([<span class="number">1</span>]), <span class="comment">// Tap anemone 7</span>
]

<span class="comment">// Calculate the effect of tapping a given anemone |m|.</span>
<span class="keyword">func</span> move(state: <span class="type">Int</span>, tap m: <span class="type">Int</span>)-&gt;<span class="type">Int</span> {
	<span class="keyword">return</span> (state | <span class="comment">// original state</span>
		<span class="call">encode</span>([m])) &amp; <span class="comment">// raise the item that was tapped</span>
		~moves[m-<span class="number">1</span>] <span class="comment">// lower the items that need to be lowered</span>
}

<span class="comment">// Brute force solver. Try all moves to depth |depth|.</span>
<span class="keyword">func</span> solve(state: <span class="type">Int</span>, goal: <span class="type">Int</span>, depth:<span class="type">Int</span>) -&gt; [<span class="type">Int</span>]? {
	<span class="keyword">if</span> state == goal {
		<span class="keyword">return</span> [] <span class="comment">// We've reached our goal, don't have to make any moves.</span>
	}
	<span class="keyword">if</span> depth &lt;= <span class="number">0</span> {
		<span class="keyword">return nil</span> <span class="comment">// Ran out of depth, give up.</span>
	}
	<span class="keyword">for</span> m <span class="keyword">in</span> <span class="number">1</span>...<span class="number">7</span> {
		<span class="keyword">let</span> newState = <span class="call">move</span>(state:state, tap:m)
		<span class="keyword">if let</span> soln = <span class="call">solve</span>(state:newState, goal:goal, depth:depth-<span class="number">1</span>) {
			<span class="comment">// If we could solve the newState, prepend our move to that solution.</span>
			<span class="keyword">return</span> [m] + soln
		}
	}
	<span class="comment">// Couldn't find a solution.</span>
	<span class="keyword">return nil</span>
}

<span class="comment">// Produce the shortest solution, if one exists.</span>
<span class="keyword">func</span> tryToSolve(state:<span class="type">Int</span>, goal:<span class="type">Int</span>, depth:<span class="type">Int</span>)-&gt; [<span class="type">Int</span>]? {
	<span class="comment">// Do a breadth first search by searching successively deeper.</span>
	<span class="keyword">for</span> d <span class="keyword">in</span> <span class="number">0</span>...depth {
		<span class="keyword">if let</span> soln = <span class="call">solve</span>(state:state, goal:goal, depth:d) {
			<span class="keyword">return</span> soln
		}
	}
	<span class="keyword">return nil</span>
}

<span class="keyword">let</span> start = <span class="call">encode</span>([<span class="number">1</span>,<span class="number">6</span>]) <span class="comment">// This will vary depending upon the state of the puzzle.</span>
<span class="keyword">let</span> goal = <span class="call">encode</span>([<span class="number">7</span>]) <span class="comment">// This is the desired state (just anenome 7 raised.)</span>
<span class="keyword">let</span> solution = <span class="call">tryToSolve</span>(state:start, goal:goal, depth:<span class="number">12</span>)

<span class="call">print</span>(solution ?? <span class="string">"no solution found"</span>)
</code></pre></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/swift">Swift</a></li><li><a href="/tags/games">Games</a></li><li><a href="/tags/botanicula">Botanicula</a></li></ul></article></div><footer><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>