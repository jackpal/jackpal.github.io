<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="GrammerJack"/><link rel="canonical" href="https://jackpal.github.io/posts/2010/01/800_lines_of_code_for_a_bencode_serializer_!"/><meta name="twitter:url" content="https://jackpal.github.io/posts/2010/01/800_lines_of_code_for_a_bencode_serializer_!"/><meta name="og:url" content="https://jackpal.github.io/posts/2010/01/800_lines_of_code_for_a_bencode_serializer_!"/><title>800 lines of code for a bencode serializer?! | GrammerJack</title><meta name="twitter:title" content="800 lines of code for a bencode serializer?! | GrammerJack"/><meta name="og:title" content="800 lines of code for a bencode serializer?! | GrammerJack"/><meta name="description" content="Jack Palevich's Essays"/><meta name="twitter:description" content="Jack Palevich's Essays"/><meta name="og:description" content="Jack Palevich's Essays"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to GrammerJack"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">GrammerJack</a><nav><ul><li><a href="/about">About</a></li><li><a class="selected" href="/posts">My posts</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>800 lines of code for a bencode serializer?!</h1><blockquote><p>Wow, my Taipei-Torrent post made it to Hacker News andreddit.com/r/programming. I'm thrilled!</p></blockquote><p>One comment on Hacker News was "800 lines for a bencode serializer?! It only took me 50 lines of Smalltalk!" That was a good comment! I replied:</p><blockquote><p>A go bencode serialization library could be smaller if it just serializedthe bencode data to and from a generic dictionary container. I think anothergo BitTorrent client, gobit, takes this approach. But it's convenient to be able to serialize arbitrary application types.That makes the bencode library larger because of the need to use go'sreflection APIs to analyze and access the application types. Go's reflectionAPIs are pretty verbose, which is why the line count is so high. To make things even more complicated, the BitTorrent protocol has a funny"compute-the-sha1-of-the-info-dictionary" requirement that forces BitTorrentclients to parse that particular part of the BitTorrent protocol using ageneric parser. So in the end, the go bencode serializer supports both a generic dictionaryparser and an application type parser, which makes it even larger.</p></blockquote><p>In general, Taipei-Torrent was not written to minimize lines-of-code. (If anything, I was trying to maximize functionality per unit of coding time.) One example of not minimizing lines-of-code is that I used a verbose error handling idiom:</p><pre><code><div class="highlight"><span></span><span class="n">a</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">f</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="k">return</span>
<span class="p">}</span>
</div></code></pre><p>There are alternative ways to handle errors in go. Some of the alternatives take fewer lines of code in some situations. The above idiom is my preference because it works correctly in all cases. But it has the drawback of adding 3 lines of code to every function call that might return an error.</p><p>The go authors are considering adding exceptions to the go language. If they do so it will probably dramatically improve the line count of Taipei-Torrent.</p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/go">go</a></li><li><a href="/tags/bittorrent">bittorrent</a></li><li><a href="/tags/taipeitorrent">Taipei-Torrent</a></li></ul></article></div><footer><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>