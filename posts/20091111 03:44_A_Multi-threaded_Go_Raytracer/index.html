<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="GrammerJack"/><link rel="canonical" href="https://jackpal.github.io/posts/20091111%2003:44_A_Multi-threaded_Go_Raytracer"/><meta name="twitter:url" content="https://jackpal.github.io/posts/20091111%2003:44_A_Multi-threaded_Go_Raytracer"/><meta name="og:url" content="https://jackpal.github.io/posts/20091111%2003:44_A_Multi-threaded_Go_Raytracer"/><title>A Multi-threaded Go Raytracer | GrammerJack</title><meta name="twitter:title" content="A Multi-threaded Go Raytracer | GrammerJack"/><meta name="og:title" content="A Multi-threaded Go Raytracer | GrammerJack"/><meta name="description" content="Jack Palevich's Essays"/><meta name="twitter:description" content="Jack Palevich's Essays"/><meta name="og:description" content="Jack Palevich's Essays"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to GrammerJack"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">GrammerJack</a></div></header><div class="wrapper"><article><div class="content"><h1>A Multi-threaded Go Raytracer</h1><p>[![](http://2.bp.blogspot.com/<em>kmzTWylBF0o/SvpD41F6d9I/AAAAAAAAC08/nwRcMOKe- qI/s400/trace.png)](http://2.bp.blogspot.com/</em>kmzTWylBF0o/SvpD41F6d9I/AAAAAAAAC08 /nwRcMOKe-qI/s1600-h/trace.png)</p><p>Above is the output of the raytracer. Below is a diagnostic mode showing which goroutines raytraced which section of the screen. Each goroutine has its own color to outline the pixels it traces:</p><p>[](http://2.bp.blogspot.com/<em>kmzTWylBF0o/SvpD41F6d9I/AAAAAAAAC08/nwRcMOKe- qI/s1600-h/trace.png) [![](http://3.bp.blogspot.com/</em>kmzTWylBF0o/SvpD4rEwtUI/AAAAAAAAC00/YcQUJ7d- Nwc/s400/cells.png)](http://3.bp.blogspot.com/_kmzTWylBF0o/SvpD4rEwtUI/AAAAAAAAC00 /YcQUJ7d-Nwc/s1600-h/cells.png)</p><p>I wrote a simple multi-threaded ray tracer in Google's new "go" language. It's an adaptation of <a href="http://www.ffconsultancy.com/languages/ray_tracer/comparison.html">Flying Frog Consultancy's Raytracer</a>.</p><p>It runs single-threaded about 1/2 the speed of a comparable C++ version. I guess the C++ version benefits from a more optimizing compiler and the ability to inline small functions.</p><p>Compared to ordinary C/C++, the Go version was easier to multithread.</p><p>On my dual-core Macbook Pro I get an 1.80x speedup when running with GOMAXPROCS &gt; 1:</p><p>$ GOMAXPROCS=1 time ./gotrace</p><p><strong>1.52</strong> real 1.50 user 0.01 sys</p><p>$ GOMAXPROCS=2 time ./gotrace</p><p><strong>0.82</strong> real 1.50 user 0.01 sys</p><p>$ GOMAXPROCS=3 time ./gotrace</p><p>0 <strong>.81</strong> real 1.50 user 0.01 sys</p><p>On an eight-core, 16 Hyperthread HP Z600 running Ubuntu 9.10, (with the source code changed to use 16 goroutines instead of the default 8 goroutines) I get a 5.8x speedup:</p><p>$ GOMAXPROCS=1 time ./gotrace</p><p>1.05user 0.01system 0:01.06elapsed 99%CPU (0avgtext+0avgdata 0maxresident)k</p><p>0inputs+1544outputs (0major+2128minor)pagefaults 0swaps</p><p>$ GOMAXPROCS=16 time ./gotrace</p><p>1.32user 0.00system 0:00.18elapsed 702%CPU (0avgtext+0avgdata 0maxresident)k</p><p>0inputs+1544outputs (0major+2190minor)pagefaults 0swaps</p><p>Source code <a href="http://jack.palevich.googlepages.com/gotracer.zip">gotracer.zip</a></p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/go">go</a></li></ul></article></div><footer><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>